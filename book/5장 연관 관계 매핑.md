#### 연관 관계 매핑

🎯 학습목표

1. 연관 관계 매핑의 종류와 엔티티 연관 관계 매핑을 설정하는 방법 학습
2. 매핑된 엔티티 조회 시 즉시 로딩과 지연 로딩의 차이점 이해

<details>
<summary>✍️ 연관 관계 매핑 종류</summary>
<br>

엔티티들은 대부분 다른 엔티티와 연관 관계를 맺고 있다.

엔티티에 연관 관계를 매핑해두고 필요할 때 연관된 엔티티를 사용하여 좀 더 객체지향적으로 프로그래밍할 수 있다.

- 연관 관계 매핑의 종류
    - 일대일: @OneToOne
    - 일대다: @OneToMany
    - 다대일: @ManyToOne
    - 다대다: @ManyToMany

- 연관 관계 매핑의 방향성
    - 단방향
    - 양방향

✔️ 일대일 단방향 매핑하기

|cart|
|---|
|cart_id (PK)|
|member_id (FK)|

|member|
|---|
|member_id (PK)|
|name|
|email|
|password|
|address|
|role|

장바구니와 회원은 일대일로 매핑돼 있으며, 장바구니 엔티티가 회원 엔티티를 참조하는 일대일 단방향 매핑이다.

엔티티를 조회할 때 연관된 엔티티도 한 번에 조회하는 것을 즉시 로딩이라고 하는데 일대일, 다대일로 매핑할 경우 즉시 로딩을 기본 Fetch 전략으로 설정한다.

✔️ 다대일 단방향 매핑하기

하나의 장바구니에는 여러 개의 상품들이 들어갈 수 있다.

또한, 같은 상품을 여러 개 주문할 수도 있으므로 몇 개를 담아 줄 것인지도 설정해야 한다.

|cart|
|---|
|cart_id (PK)|
|member_id (FK)|

|cart_item|
|---|
|cart_item_id (PK)|
|cart_id (FK)|
|item_id (FK)|
|count|

|item|
|---|
|item_id (PK)|
|item_nm|
|price|
|stock_number|
|item_detail|
|item_sell_status|

✔️ 다대일/일대다 양방향 매핑하기

양방향 매핑이란 단방향 매핑이 2개 있다고 생각하면 된다.

|member|
|---|
|member_id (PK)|
|name|
|email|
|password|
|address|
|role|

|orders|
|---|
|order_id (PK)|
|member_id (FK)|
|order_date|
|order_status|

|order_item|
|---|
|order_item_id (PK)|
|order_id (FK)|
|item_id (FK)|
|order_price|
|count|

양방향 매핑에서는 '연관 관계 주인'을 설정해야 한다는 점이 중요하다.

ORDERS와 ORDER_ITEM 테이블을 ORDER_ID를 외래키로 조인하면 주문에 속한 상품들을 알 수 있고 주문 상품은 어떤 주문에 속하는지 알 수 있다. 즉, 테이블은 외래키 하나로 양방향 조회가 가능하다.

엔티티는 테이블과 다른데 양방향 연관 관계에서 객체의 참조는 둘인데 외래키는 하나이므로 둘 중 누가 외래키를 관리할지를 정해야 한다.

- 연관 관계의 주인은 외래키가 있는 곳으로 설정
- 연관 관계의 주인이 외래키를 관리(등록, 수정, 삭제)
- 주인이 아닌 쪽은 연관 관계 매핑시 mappedBy 속성의 값으로 연관 관계의 주인을 설정
- 주인이 아닌 쪽은 일기만 가능

</details>
